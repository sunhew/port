<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>portfolio</title>

    <link rel="stylesheet" href="asset/css/style.css">
    <style>
        body {
            overflow-x: hidden;
            margin: 0;
        }

        #particles {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            filter: url("#goo");
        }

        svg {
            display: block;
            width: 30px;
            height: 30px;
            position: absolute;
            transform: translateZ(0px);
            fill: #0038E9;
        }

        .text div,
        header *,
        .intro_Circle_left div,
        .intro_Circle_right div {
            opacity: 0;
        }

        .char {
            display: inline-block;
            opacity: 0;
        }
    </style>
</head>

<body>
    <header id="header">
        <h1>Creative<span>Dev</span></h1>
        <nav>menu</nav>
    </header>
    <!-- //header -->

    <section id="section1">
        <div class="text">
            <div>the</div>
            <div data-text-split>Innovation</div>
            <div>portfolio</div>
        </div>
        <div id="particles"></div>
        <svg>
            <defs>
                <filter id="goo">
                    <feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="12" />
                    <feColorMatrix in="blur" result="colormatrix" type="matrix"
                        values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 21 -9" />
                    <feBlend in="SourceGraphic" in2="colormatrix" />
                </filter>
            </defs>
        </svg>
        <div class="intro_Circle">
            <div class="intro_Circle_left">
                <div class="circle1"></div>
                <div class="circle2"></div>
            </div>
            <div class="intro_Circle_right">
                <div class="circle3"></div>
                <div class="circle4"></div>
            </div>
            <div class="intro_Circle_center">
                <div class="intro_circle"></div>
                <div class="intro_abot"></div>
            </div>
        </div>
    </section>
    <!-- //section1 -->

    <section id="section2"></section>
    <section id="section3"></section>
    <section id="section4"></section>
    <section id="section5"></section>
    <section id="section6"></section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/timothydesign/script/split-type.js"></script>
    <script>
        gsap.registerPlugin(ScrollTrigger);

        $(document).ready(function () {
            // 텍스트를 개별 문자로 분리
            let splitType = new SplitType("[data-text-split]", {
                types: "chars",
                tagName: "span"
            });

            let tl = gsap.timeline();
            tl.set(".text div, header *, .intro_Circle_left div, .intro_Circle_right div", { opacity: 0, y: -50 })  // 모든 텍스트 요소, 헤더 요소, intro_Circle 요소를 숨기고 위로 이동
                .to(".text div:nth-child(1)", { opacity: 1, y: 0, duration: 0.5, delay: 0.5 })  // the 텍스트 나타남
                .to(".text div:nth-child(2)", { opacity: 1, y: 0, duration: 0.5, onStart: startParticles })  // Innovation 텍스트 나타날 때 particles 시작
                .to(".char", { opacity: 1, y: -20, duration: 0.6, ease: "back.out(1.7)", stagger: { each: 0.2 } }, "<")  // Innovation 텍스트의 각 문자가 0.2초 간격으로 튀듯이 나타남
                .to(".text div:nth-child(3)", { opacity: 1, y: 0, duration: 0.5, delay: 0.1 })  // Innovation 텍스트가 다 나타난 후 portfolio 텍스트 나타남
                .to("header *", { opacity: 1, y: 0, duration: 0.6, ease: "bounce.out", stagger: 0.1 }, "-=0.4")  // portfolio 텍스트가 나타난 후 헤더 요소들이 위에서 아래로 떨어지듯 나타남
                .to(".intro_Circle_left div:nth-child(1)", { opacity: 1, x: 97, duration: 0.5, ease: "back.out(1.7)" }, "+=0.2")  // 헤더 요소가 나타난 후 intro_Circle_left 첫 번째 요소가 대각선으로 튀어나옴
                .to(".intro_Circle_right div:nth-child(1)", { opacity: 1, x: -22, duration: 0.5, ease: "back.out(1.7)" }, "<0.1")  // intro_Circle_right 첫 번째 요소가 대각선으로 튀어나옴
                .to(".intro_Circle_left div:nth-child(2)", { opacity: 1, x: 79, duration: 0.5, ease: "back.out(1.7)" }, "<0.2")  // intro_Circle_left 두 번째 요소가 대각선으로 튀어나옴
                .to(".intro_Circle_right div:nth-child(2)", { opacity: 1, x: -5, duration: 0.5, ease: "back.out(1.7)" }, "<0.1");  // intro_Circle_right 두 번째 요소가 대각선으로 튀어나옴

            // 스크롤 이벤트를 이용하여 intro_Circle_left와 intro_Circle_right 요소들이 순차적으로 중앙으로 이동 (x축만 이동)
            let scrollTimeline = gsap.timeline({
                scrollTrigger: {
                    trigger: "#section1",
                    start: "top top",
                    end: "bottom top",
                    scrub: true,
                    invalidateOnRefresh: true,
                }
            });

            scrollTimeline.to(".intro_Circle_left .circle1", {
                x: '45vw', // 첫 번째 원이 중앙으로 이동
                duration: 1,
            }).to(".intro_Circle_left .circle2", {
                x: '33vw', // 두 번째 원이 중앙으로 이동
                duration: 1,
            }, "<0.3"); // 첫 번째 원이 이동을 시작한 후 0.3초 뒤에 시작

            scrollTimeline.to(".intro_Circle_right .circle3", {
                x: '-45vw', // 첫 번째 원이 중앙으로 이동
                y: '2vw',
                duration: 1,
            }, "-=0.5").to(".intro_Circle_right .circle4", {
                x: '-33vw', // 두 번째 원이 중앙으로 이동
                duration: 1,
            }, "<0.3"); // 첫 번째 원이 이동을 시작한 후 0.3초 뒤에 시작

            function startParticles() {
                let isPaused = false;
                window.onblur = function () {
                    isPaused = true;
                }.bind(this);
                window.onfocus = function () {
                    isPaused = false;
                }.bind(this);

                let particles = [];

                setInterval(function () {
                    if (!isPaused) {
                        particles.push(
                            new Particle(circle, {
                                "x": (Math.random() * $(window).width()),
                                "y": $(window).height() + 100
                            }, (1 + Math.random()))
                        );
                    }
                }, 180);

                function update() {
                    particles = particles.filter(function (p) {
                        return p.move();
                    });
                    requestAnimationFrame(update.bind(this));
                }
                update();
            }
        });

        const circle = '<svg viewBox="0 0 67.4 67.4"><circle class="circle" cx="33.7" cy="33.7" r="33.7"/></svg>';

        class Particle {
            constructor(svg, coordinates, friction) {
                this.svg = svg;
                this.steps = ($(window).height()) / 2;
                this.item = null;
                this.friction = friction;
                this.coordinates = coordinates;
                this.position = this.coordinates.y;
                this.dimensions = this.render();
                this.move();
                this.rotation = Math.random() > 0.5 ? "-" : "+";
                this.scale = 0.4 + (Math.random() * 2);
                this.siner = $(window).width() / 2.5 * Math.random();
            }
            destroy() {
                this.item.remove();
            }
            move() {
                this.position = this.position - this.friction;
                let top = this.position;
                let left = this.coordinates.x + Math.sin(this.position * Math.PI / this.steps) * this.siner;
                this.item.css({
                    transform: "translateX(" + left + "px) translateY(" + top + "px) scale(" + this.scale + ") rotate(" + (this.rotation) + (this.position + this.dimensions.height) + "deg)"
                });
                if (this.position < -(this.dimensions.height)) {
                    this.destroy();
                    return false;
                } else {
                    return true;
                }
            }
            render() {
                this.item = $(this.svg, {
                    css: {
                        transform: "translateX(" + this.coordinates.x + "px) translateY(" + this.coordinates.y + "px)"
                    }
                });
                $("#particles").append(this.item);
                return {
                    width: this.item.width(),
                    height: this.item.height()
                };
            }
        }
    </script>
</body>

</html>